!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).ServiceCatalog=e.ServiceCatalog||{},e.ServiceCatalog.min=e.ServiceCatalog.min||{},e.ServiceCatalog.min.js={}))}(this,(function(e){"use strict";const t={},s="https://cdn.ezassets.com",a={service_item:"service_item_placeholder",assigned_asset:"asset_placeholder",assigned_software_license:"software_license_placeholder"};function i(e){return e.test(window.location.pathname)}function r(e,t){let s=0;function a(){s++,s===e.filter((e=>"script"===e.type)).length&&t()}e.forEach((e=>{!function(e,t,s){const a=document.createElement(t);"link"===t?(a.rel="stylesheet",a.type="text/css",a.href=e):"script"===t&&(a.type="text/javascript",a.src=e,a.onload=s);document.head.appendChild(a)}(e.url,e.type,a)}))}function n(e){return/^\d*_my_assigned_assets$/.test(e)}function o(){return!("anonymous"===window.HelpCenter.user.role)}function c(){const e={};e.return_to=window.location.href;return`${window.location.origin}/hc/signin?${$.param(e)}`}function d(e){let t=e.type,i=null;return i=t?a[t]:a.service_item,`${s}/shared/service_catalog/assets/images/svg/${i}.svg`}function l(e){const t=$("<div>").attr("id","loading_icon_container").addClass(e),s=$("<div>").addClass("d-flex flex-column align-items-center"),a=$("<img>").attr({src:"https://s2.svgbox.net/loaders.svg?ic=puff",alt:"Loading..."});return s.append(a),t.append(s),t}function u(e){let t=e.service_items.assets||[],s=e.service_items.software_entitlements||[];return t.concat(s)}class p{constructor(e,t,s){this.ezoFieldId=e,this.ezoSubdomain=t,this.ezoServiceItemFieldId=s}updateRequestForm(){const e=this,t=this.extractRequestId(),s="/api/v2/requests/"+t;this.hideAssetsCustomField(),$.getJSON(s).done((s=>{const a=s.request.custom_fields.find((function(t){return t.id==e.ezoFieldId})),i=s.request.custom_fields.find((function(t){return t.id==e.ezoServiceItemFieldId})),r=e.fieldDataPresent(a),n=e.fieldDataPresent(i);if(!r&&!n)return!0;const o={headers:{}};return e.withToken((s=>{if(s){o.headers.Authorization="Bearer "+s,o.headers["ngrok-skip-browser-warning"]=!0,n&&!r&&e.linkResources(t,{headers:o.headers,serviceItemFieldId:e.ezoServiceItemFieldId});const c=JSON.parse(a.value),d=c.assets.map((e=>Object.keys(e)[0])),l=c.assets.map((e=>Object.values(e)[0]));if(!d||0==d.length||!i)return!0;"true"!=c.linked&&e.linkResources(t,{headers:o.headers,ezoFieldId:e.ezoFieldId}),l&&(e.addEZOContainer(),l.map((t=>{e.showLinkedAsset(t)})))}}))}))}extractRequestId(){return window.location.pathname.split("/").pop()}hideAssetsCustomField(){const e=$("dd:contains('{\"assets\":[{')");e[0]&&(e[0].style.display="none",e[0].previousElementSibling.style.display="none")}withToken(e){return $.getJSON("/hc/api/v2/integration/token").then((t=>e(t.token)))}linkResources(e,t){const s=t.ezoFieldId,a=t.serviceItemFieldId,i={ticket_id:e};s&&(i.assets_field_id=s),a&&(i.service_item_field_id=a);const r=t.headers||{};$.ajax({url:"https://"+this.ezoSubdomain+"/webhooks/zendesk/link_ticket_to_resource.json",type:"POST",data:{ticket:i},headers:r})}addEZOContainer(){$("dl.request-details").last().after('<dl class="request-details" id="ezo-assets-container"><dt>AssetSonar Assets</dt><dd><ul></ul></dd></dl>')}showLinkedAsset(e){const t=this.getAssetUrl(e),s=$("#ezo-assets-container dd ul");t?s.append("<li><a target='_blank' href='"+t+"'>"+e+"</a></li>"):s.append("<li>"+e+"</li>")}getAssetUrl(e){if(!e)return null;const t=(e=e.trim()).match(/^(Asset|Asset Stock|Software License) # (\d+) /);if(!t)return null;const s=t[2],a=t[1];return"https://"+this.ezoSubdomain+this.getAssetPath(s,a)}getAssetPath(e,t){return({Asset:"/assets/","Stock Asset":"/stock_assets/","Software License":"/software_licenses/"}[t]||"/dashboard")+e}fieldDataPresent(e){return e&&e.value}}class h{constructor(e,t,s){this.ezoFieldId=e,this.ezoSubdomain=t,this.ezoServiceItemFieldId=s}updateRequestForm(){r(this.filesToLoad(),(()=>{this.updateForm()}))}updateForm(){if("-"===$(".nesty-input")[0].text)return;const e=this.extractQueryParams(window.location),t=this.prepareSubject(e),s=this.prepareServiceItemFieldValue(e);t&&$("#request_subject").val(t),s&&$("#request_custom_fields_"+this.ezoServiceItemFieldId).val(s),this.getTokenAndFetchAssignedAssets()}extractQueryParams(e){return new URL(e).searchParams}getTokenAndFetchAssignedAssets(){return this.withToken().then((e=>{if(e){const t={method:"GET",headers:{Authorization:"Bearer "+e,"ngrok-skip-browser-warning":!0}},s="https://"+this.ezoSubdomain+"/webhooks/zendesk/user_assigned_assets_and_software_entitlements.json";return this.populateAssignedAssets(s,t)}}))}withToken(){return $.getJSON("/hc/api/v2/integration/token").then((e=>e.token))}populateAssignedAssets(e,t){fetch(e,t).then((e=>e.json())).then((s=>{const a={data:[]},i=$("#request_custom_fields_"+this.ezoFieldId);this.processData(s.assets,a,"Asset"),this.processData(s.software_entitlements,a,"Software License"),i.hide(),i.after("<select multiple='multiple' id='ezo-asset-select' style='width: 100%;'></select>"),this.renderSelect2PaginationForUsers($("#ezo-asset-select"),e,t),this.preselectAssetsCustomField(this.extractQueryParams(window.location)),$("form.request-form").on("submit",(function(){var e=$("#ezo-asset-select").val();if(e.length>0){let t=a.data.filter((t=>e.includes(t.id.toString())));t=t.map((e=>({[e.id]:e.text}))),i.val(JSON.stringify({assets:t}))}}))}))}renderSelect2PaginationForUsers(e,t,s){e.select2({dropdownParent:e.parents("body"),ajax:{url:t,delay:250,headers:s.headers,dataType:"json",data:function(t){return{page:t.page||1,search:t.term,include_blank:$(e).data("include-blank")}},processResults:function(e,t){var s=$.map(e.assets,(function(e){var t=e.sequence_num;return{id:t,text:`Asset # ${t} - ${e.name}`}})),a=$.map(e.software_entitlements,(function(e){var t=e.sequence_num;return{id:t,text:`Software License # ${t} - ${e.name}`}}));return{results:s.concat(a),pagination:{more:e.page<e.total_pages}}}}})}prepareSubject(e){const t=e.get("item_name"),s=e.get("service_category");return null==t||null==s?null:`Report Issue on ${s} - ${t}`}prepareServiceItemFieldValue(e){const t=e.get("item_name"),s=e.get("service_item_id");return null==t&&null==s?null:s?`${s} - ${t}`:t}preselectAssetsCustomField(e){let t=$("#request_custom_fields_"+this.ezoFieldId);if(!this.assetsCustomFieldPresent(t))return;let s=e.get("item_id"),a=e.get("item_name");if(!a||!s)return;let i=$("#ezo-asset-select");if(0===i.length&&this.renderEzoSelect2Field(t),i.find("option[value='"+s+"']").length)i.val(s).trigger("change");else{var r=new Option(a,s,!0,!0);i.append(r).trigger("change")}}assetsCustomFieldPresent(e){return e.length>0}renderEzoSelect2Field(e){e.hide(),e.after("<select multiple='multiple' id='ezo-asset-select' style='width: 100%;'></select>")}filesToLoad(){return[{type:"link",url:"https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css"},{type:"script",url:"https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"}]}processData(e,t,s){e&&$.each(e,(function(e,a){var i=a.sequence_num;t.data[i]={id:i,text:`${s} # ${i} - ${a.name}`}}))}}function m(e){if(0!==Object.keys(t).length)return g();(function(e){return $.getJSON(`https://mehboobali98.github.io/service-catalog/dist/public/i18n/${e}.json`)})(e).done((function(e){$.extend(t,e),g()})).fail((function(){console.error("Failed to load translations.")}))}function g(){$("[data-i18n]").each((function(){!function(e){const s=e.attr("data-i18n"),a=t[s];if(void 0!==a)if(void 0!==e.attr("placeholder"))e.attr("placeholder",a);else if("report-issue"==s||"request"==s){var i=e.text(),r={request:"Request","report-issue":"Report Issue"};void 0!==r[s]&&(i=i.replace(r[s],a),e.text(i))}else e.text(a);else console.warn(`Translation for key '${s}' not found.`)}($(this))}))}function v(e){return"Asset #"==e?"asset-sequence-num":"AIN"==e?"identifier":"Software License #"==e?"software-license-sequence-num":"License Identification Number"==e?"software-license-identifier":e.replace(/\s+/g,"-").toLowerCase()}class f{constructor(e){this.locale=e,this.currency=null,this.serviceCategoriesItems=null}build(e){this.currency=e.currency,this.serviceCategoriesItems=e.service_catalog_data,$.each(this.serviceCategoriesItems,((e,t)=>{let s=$(`#${`${e}_container`}`);if(!n(e)&&t.service_items){let a=JSON.parse(t.service_items);$.each(a,((t,a)=>{s.after(this.buildDetailPage(e,a)),this.bindItemDetailEventListener(e,a)}))}}))}buildDetailPage(e,t){const s=t.display_fields,a=`detail_page_container${t.id}${e}${s.title.value}`,i={},r=$("<div>").attr("id",a).addClass("row").css({display:"none","margin-top":"38px","margin-right":"184px"}),n=$("<div>").addClass("col-3"),o=d(t),c=$("<img>").attr("src",t.display_picture_url||o).attr("alt","placeholder image").addClass("w-100").on("error",(function(){$(this).attr("src",o)}));n.append(c),getComputedStyle(document.documentElement).getPropertyValue("--ez_text_font");const l=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_color"),u=getComputedStyle(document.documentElement).getPropertyValue("--ez_heading_font"),p=$("<div>").addClass("col-9"),h=$("<div>").addClass("d-flex justify-content-between"),m=$("<div>").append($("<p>").text(s.title.value).css({color:l,"line-height":"17px","font-family":u,"font-weight":"600","font-size":"16px"}));s.cost_price&&m.append($("<p>").text(`${this.currency} ${parseFloat(s.cost_price.value)}`).css({color:l,"line-height":"17px","font-family":u,"font-size":"14px"})),i.item_name=s.title.value,i.ticket_form_id=t.zendesk_form_id,i.service_item_id=t.id,i.service_category=this.serviceCategoriesItems[e].title;const g=`/hc/requests/new?${$.param(i)}`,v=$("<div>").addClass("request-service-btn-container"),f=$("<a>").attr("href",g).attr("data-i18n","request-service").text("Request Service").addClass("btn btn-outline-primary request-service-btn");v.append(f),h.append(m,v);const _=$("<div>").addClass("mt-3");return Object.keys(s).length&&$.each(s,((e,t)=>{if("description"==e){let e=$("<section>"),s=$("<p>").attr("data-i18n","service-item-details").text(t.label).css({color:l,"line-height":"17px","font-style":u,"font-weight":"600","font-size":"16px"}),a=this.prepareSectionContent(t);e.append(s,a),_.append(e)}})),p.append(h,_),r.append(n,p),r}prepareSectionContent(e){const t=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_font"),s=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_color"),a=e.value,i=e.format;if(!i)return $("<p>").text(a).css({color:s,"font-size":"14px","font-weight":"400","line-height":"17px","font-family":t,"font-size":"12px"});if("list"===i){const e=$("<ul>").addClass("service-item-detail-description-list"),t=a.split(",");return $.each(t,(function(t,s){let a=$("<li>").text(s);e.append(a)})),e}}bindItemDetailEventListener(e,t){$("body").on("click",".js-service-item-detail-page-btn, .js-default-service-item",(function(e){e.preventDefault();const t=$(this).data("id"),s=$(this).data("name"),a=$(this).data("container-id"),i=$(`#${a}`),r=`detail_page_container${t}${s}`,n=$(document.getElementById(r));$("#service_catalog_item_search_results_container").hide(),i.hide(),$("[id*='_service_items_container']").hide(),$("#service_items_container").show(),n.show()}))}}class _{constructor(e){this.locale=e,this.currency=null,this.zendeskFormData=null,this.serviceCategoriesItems=null}build(e){this.currency=e.currency,this.serviceCategoriesItems=e.service_catalog_data;const t=Object.keys(this.serviceCategoriesItems),s=$("<div>").attr("id","service_items_container").addClass("col-10 service-items-container");return t.forEach(((e,t)=>{const a=this.serviceCategoriesItems[e];s.append(this.buildServiceCategoryItems(e,a,0===t))})),s}buildServiceCategoryItems(e,t,a){const i=$("<div>");i.attr("id",`${e}_container`),a||i.addClass("collapse");const r=t.title,o=$("<p>").attr("data-i18n",v(r)).text(r).addClass("service-category-label"),c=$("<p>").attr("data-i18n",v(`${r} Description`)).text(t.description).addClass("service-category-description");i.append(o,c);const d=$("<div>").attr("id",`${e}_service_items_container`);a||d.append(l("col-10"));const p=$("<div>").addClass("d-flex flex-wrap gap-3");if(t.service_items){let s=[];n(e)?(s=u(t),this.zendeskFormData=t.zendesk_form_data):s=t.service_items?JSON.parse(t.service_items):[],s.length&&s.forEach(((t,s)=>{t&&p.append(this.buildServiceCategoryItem(e,t))}))}else n(e)&&d.append(function(e){const t=$("<div>").attr("id","no_service_items_found_container").addClass("d-flex flex-column align-items-center no-results-container"),a=$("<img>").attr("src",`${s}/shared/service_catalog/dist/public/assets/images/svg/service_asset.svg`).addClass("no-results-image"),i=$("<p>").attr("data-i18n",e).text(notFoundMessage).addClass("no-results-message");return t.append(a,i),t}("There are no assigned items for you in the system."));return d.append(p),i.append(d),i}buildServiceCategoryItem(e,t){return n(e)?this.buildItAssetServiceItem(e,t):this.buildDefaultServiceItem(e,t)}buildItAssetServiceItem=(e,s)=>{const a=$("<div>").addClass("row service-item-card"),i={},r=this.serviceCategoriesItems[e].title,n=$("<div>").addClass("col-4"),o=$("<div>").addClass("d-flex flex-column h-100 service-item-card-image-container"),c=d(s),l=$("<img>").attr("src",s.display_picture_url).attr("alt","IT Asset").addClass("w-100").on("error",(function(){$(this).attr("src",c)}));o.append(l),n.append(o);const u=$("<div>").addClass("col-8 card-body"),p=s.name,h=$("<p>").text(p).addClass("card-title truncate-text").attr("data-text",p);u.append(h);const m=$("<div>").addClass("card-content-container"),g=$("<table>").addClass("card-content-table");this.populateCardContent(g,s),m.append(g),u.append(m),i.item_id=s.sequence_num,i.item_name=p,i.ticket_form_id=this.zendeskFormId(s),i.service_category=function(e,s){const a=t[e];return void 0!==a?a:s||""}(v(r),r);const f=`/hc/requests/new?${$.param(i)}`,_=$("<div>").addClass("it-asset-card-footer w-100"),C=$("<a>").attr("href",f).attr("data-i18n","report-issue").text("Report Issue").addClass("float-end footer-text");return C.append($("<span>").html("&#8594;").addClass("footer-arrow")),_.append(C),u.append(_),a.append(n,u),a.click((function(e){e.preventDefault(),window.location.href=f})),a};buildDefaultServiceItem(e,t){const s=t.display_fields,a=$("<div>").addClass("row service-item-card border border-light js-default-service-item").data("id",`${t.id}${e}`).data("name",s.title.value).data("container-id",`${e}_service_items_container`),i=$("<div>").addClass("col-4"),r=$("<div>").addClass("d-flex flex-column h-100 service-item-card-image-container"),n=d(t),o=$("<img>").attr("src",t.display_picture_url||n).attr("alt","Software").addClass("w-100").on("error",(function(){$(this).attr("src",n)}));r.append(o),i.append(r);const c=$("<div>").addClass("col-8 card-body"),l=s.title.value,u=$("<p>").text(l).addClass("card-title truncate-text").attr("data-text",l);c.append(u);const p=$("<p>").text(s.short_description.value).addClass("description");c.append(p);const h=$("<div>").addClass("card-footer w-100");if(s.cost_price){const e=$("<span>").text(`${this.currency} ${parseFloat(s.cost_price.value)}`);h.append(e)}const m=$("<a>").attr("href","#_").attr("data-i18n","request").text("Request").addClass("float-end footer-text"),g=$("<span>").html("&#8594;").addClass("footer-arrow float-end js-service-item-detail-page-btn").data("id",`${t.id}${e}`).data("name",s.title.value).data("container-id",`${e}_service_items_container`);return m.append(g),h.append(m),c.append(h),a.append(i,c),a}populateCardContent(e,t){const s=t.asset_columns||t.software_license_columns;if(0!==Object.keys(s).length)$.each(s,((t,s)=>{let a=$("<tr>"),i=this.fieldValueElement(t||"--","th",30);"fr"==this.locale&&i.attr("data-i18n",v(t)),a.append(i),a.append(this.fieldValueElement(s||"--","td",15)),e.append(a)}));else{const t="No attributes configured";e.append($("<tr>").append(this.fieldValueElement(t,"th",t.length).attr("data-i18n","no-attributes-configured")))}}fieldValueElement(e,t,s){const a=$(`<${t}>`),i=e.length>s;if(!i)return a.text(e);const r=i?`${e.substring(0,s)}...`:e;return a.text(r).attr("title",e).attr("data-toggle","tooltip")}zendeskFormId(e){const t=e.type;return"assigned_asset"===t?this.zendeskFormData.assets:"assigned_software_license"===t?this.zendeskFormData.software_entitlements:void 0}buildAndRenderServiceItems=(e,t)=>{const s=e.service_catalog_data;this.currency=e.currency;const a=Object.keys(s)[0],i=s[a];$(t).children().first().hide();const r=$(t).children().last();r.empty();let o=[];o=n(a)?u(i):i.service_items?JSON.parse(i.service_items):[],o.length&&o.forEach(((e,t)=>{e&&r.append(this.buildServiceCategoryItem(a,e))})),n(a)||(new f).build(e)}}class C{constructor(){this.itemBuilder=null,this.itemDetailBuilder=null}updateResults=(e,t)=>{const a=t.searchResultsContainer;if(a.empty(),!e.search_results.length)return void a.append(function(){const e=$("<div>").attr("id","no_results_container").addClass("d-flex flex-column align-items-center no-results-container"),t=$("<img>").attr("src",`${s}/shared/service_catalog/dist/public/assets/images/svg/no_results_found.svg`).addClass("no-results-image"),a=$("<p>").attr("data-i18n","no-results-found").text("No Result Found").addClass("no-results-message");return e.append(t,a),e}());self=this,self.itemBuilder=t.itemBuilder;const i=$("<div>").addClass("d-flex flex-wrap gap-3");self.itemDetailBuilder=t.itemDetailBuilder;const r=Array.isArray(e.search_results)?e.search_results:JSON.parse(e.search_results);$.each(r,(function(e,t){if(t){let e=t.service_category_title_with_id,s=self.itemBuilder.buildServiceCategoryItem(e,t);self.itemDetailBuilder.bindItemDetailEventListener(s),i.append(s)}})),a.append(i)}}class b{constructor(e,t){this.locale=e,this.ezoSubdomain=t}fetchServiceCategoriesAndItems(e,t,a){$.getJSON("/hc/api/v2/integration/token").then((e=>e.token)).then((i=>{if(i){const r="visible_service_categories_and_items",n={},o={method:"GET",headers:{Authorization:"Bearer "+i,"ngrok-skip-browser-warning":!0}};a.searchQuery&&(n.search_query=a.searchQuery);const c="https://"+this.ezoSubdomain+"/webhooks/zendesk/"+r+".json?"+$.param(n);fetch(c,o).then((e=>{if(400==e.status)throw new Error("Bad Request: There was an issue with the request.");if(403==e.status)return e.json().catch((()=>t()));if(404==e.status)return t();if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((t=>{$("#loading_icon_container").empty(),void 0===t.service_catalog_enabled||t.service_catalog_enabled?function(e){return e&&e.service_catalog_data&&Object.keys(e.service_catalog_data).length>0}(t)||t.search_results?e(t,a):$("main").append(function(e){const t=$("<div>").addClass("d-flex flex-column align-items-center service-catalog-empty-container"),a=$("<img>").attr("src",`${s}/shared/service_catalog/dist/public/assets/images/svg/service_category.svg`).addClass("no-access-image"),i=$("<p>").attr("data-i18n","create-and-enable-service-categories").text("Please create and enable service categories in the builder to start using Service Catalog.").addClass("next-steps-message"),r=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),n=`https://${e}/service_catalog/builder`,o=$("<a>").attr("href",n).attr("data-i18n","go-to-service-catalog-builder").text("Go to Service Catalog Builder").addClass("btn btn-outline-primary go-back-btn");return r.append(o),t.append(a,i,r),t}(this.ezoSubdomain)):$("main").append(function(e){const t=$("<div>").addClass("d-flex flex-column align-items-center service-catalog-disabled-container"),a=$("<img>").attr("src",`${s}/shared/service_catalog/dist/public/assets/images/svg/no_access_image.svg`).addClass("no-access-image"),i=$("<p>").attr("data-i18n","enable-service-catalog").text("Please enable Service Catalog Builder in Asset Sonar to start using Service Catalog.").addClass("next-steps-message"),r=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),n=`https://${e}/companies/settings`,o=$("<a>").attr("href",n).attr("data-i18n","go-to-assetsonar").text("Go to AssetSonar").addClass("btn btn-outline-primary go-back-btn");return r.append(o),t.append(a,i,r),t}(this.ezoSubdomain)),m(this.locale)})).catch((e=>{console.error("An error occurred while fetching service categories and items: "+e.message)}))}}))}fetchServiceCategoryItems(e,t,s){$.getJSON("/hc/api/v2/integration/token").then((e=>e.token)).then((a=>{if(a){const i={method:"GET",headers:{Authorization:"Bearer "+a,"ngrok-skip-browser-warning":!0}},r="visible_service_categories_and_items",n={service_category_id:e},o="https://"+this.ezoSubdomain+"/webhooks/zendesk/"+r+".json?"+$.param(n);$("#loading_icon_container").show(),fetch(o,i).then((e=>{if(400===e.status)throw new Error("Bad Request: There was an issue with the request.");if(404===e.status)return noAccessPageCallback();if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e,s.serviceItemsContainerId),m(this.locale)})).catch((e=>{console.error("An error occurred while fetching service categories and items: "+e.message)}))}}))}withToken(){return $.getJSON("/hc/api/v2/integration/token").then((e=>e.token))}}class w{constructor(e,t){this.locale=e,this.apiService=new b(e,t),this.ezoSubdomain=t,this.serviceCatalogItemBuilder=new _(e),this.serviceCatalogItemDetailBuilder=new f(e),this.search=new C}addMenuItem(e,t,s){const a=$(`#${s}`),i=$("<a>",{href:t,text:e}).addClass("service-catalog-nav-item nav-link").attr("data-i18n","service-catalog"),r=a.children(":first");r.is("ul")?r.prepend($("<li>").append(i)):a.prepend(i)}buildServiceCatalog(){this.buildServiceCatalogHeaderSection(),$("main").append(l("mt-5")),this.apiService.fetchServiceCategoriesAndItems(this.buildUI,this.noAccessPage,{})}buildServiceCatalogHeaderSection(){const e=$("<section>"),t=$("<div>").addClass("jumbotron jumbotron-fluid service-catalog-header-container"),s=$("<h2>").addClass("service-catalog-header-label").attr("data-i18n","service-catalog").text("Service Catalog"),a=$("<p>").addClass("service-catalog-description").attr("data-i18n","service-catalog-description").text("Explore the Service Catalog to find a curated range of solutions to your needs");t.append(s,a),e.append(t),$("main").append(e)}buildUI=(e,t)=>{this.data=e;const s=$("<section>").attr("id","service_catalog_section").addClass("service-catalog-section"),a=$("<div>").addClass("row"),i=$("<div>").addClass("col-2"),r=$("<p>").addClass("service-categories-heading").attr("data-i18n","categories").text("Categories"),n=$("<input>").attr("id","search_input").attr("type","text").attr("data-i18n","search").attr("placeholder","search..."),o=$("<div>").append(n).addClass("service-catalog-search");i.append(r,o);const c={newSection:s,searchAndNavContainer:i,serviceCatalogContainer:a};this.createServiceCategoriesView(c)};createServiceCategoriesView(e){const t=$("<div>").attr("id","service_categories_list").addClass("service-categories-list"),s=this.generateNavbar();t.append(s);const a=e.newSection,i=e.searchAndNavContainer,r=e.serviceCatalogContainer;i.append(t);const n=this.serviceCatalogItemBuilder.build(this.data),o=$("<div>").attr("id","service_catalog_item_search_results_container").addClass("col-10 collapse service-catalog-search-results-container");r.append(i,n,o),a.append(r),$("main").append(a),this.serviceCatalogItemDetailBuilder.build(this.data),this.bindEventListeners(),this.addTooltipsForTruncatedText()}generateNavbar(){const e=$("<ul>");let t=!1;const s=this.data.service_catalog_data;return $.each(s,(function(s,a){let i=$("<li>").append($("<a>").attr({id:s+"_link",href:"#_",target:"_blank","data-i18n":v(a.title)}).text(a.title));t||(t=!0,i.addClass("active")),e.append(i)})),e}bindEventListeners(){let e=null;const t=this,s=Object.keys(this.data.service_catalog_data).map((e=>"#"+e+"_link"));$(s.join(", ")).click((function(e){var a=$(this).attr("id");if($("#"+e.target.id).parent().hasClass("active"))return!1;$("#service_categories_list ul li.active").removeClass("active"),$("#"+e.target.id).parent().addClass("active"),e.preventDefault();var i=a.replace("_link","_container");$.each(s,(function(e,t){"#"+a===t||$(t.replace("_link","_container")).hide()})),$("[id*='detail_page_container']").hide();const r={serviceItemsContainerId:"#"+i.replace("_container","_service_items_container")},n=a.split("_")[0];t.apiService.fetchServiceCategoryItems(n,t.serviceCatalogItemBuilder.buildAndRenderServiceItems,r),$("#service_catalog_item_search_results_container").hide(),$("#"+i).show(),$("#"+i.replace("_container","_service_items_container")).show(),$("#service_items_container").show()})),$("#search_input").on("keyup",(function(s){s.preventDefault();const a=$(this).val().trim(),i=$("#service_items_container"),r=$("#service_catalog_item_search_results_container");$("#service_categories_list ul li.active"),0===a.length?(r.hide(),i.show()):(i.hide(),r.empty(),r.append(l("col-10")),r.show(),e&&clearTimeout(e),e=setTimeout((function(){t.apiService.fetchServiceCategoriesAndItems(t.search.updateResults,t.noAccessPage,{searchQuery:a,searchResultsContainer:r,itemBuilder:t.serviceCatalogItemBuilder,itemDetailBuilder:t.serviceCatalogItemDetailBuilder})}),500))}))}addTooltipsForTruncatedText(){$(".truncate-text, .truncate-text-two-lines").each((function(){if(this.scrollWidth>this.offsetWidth){var e=$(this).attr("data-text");$(this).attr("title",e).attr("data-toggle","tooltip")}}))}noAccessPage(){const e=$("<section>").attr("id","no_access_page_section").addClass("no-access-page-section"),t=$("<div>").addClass("d-flex flex-column align-items-center"),a=$("<img>").attr("src",`${s}/shared/service_catalog/dist/public/assets/images/svg/no_access_image.svg`).addClass("no-access-image"),i=$("<h4>").attr("data-i18n","unauthorized-label").text("You do not have permission to access this page!"),r=$("<p>").attr("data-i18n","contact-administrator-label").text("Please contact your administrator to get access").addClass("next-steps-message"),n=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),o=$("<a>").attr("href","#_").attr("data-i18n","go-back").text("Go Back").addClass("btn btn-outline-primary go-back-btn").click((function(){window.history.back()}));n.append(o),t.append(a,i,r,n),e.append(t),$("main").append(e)}}e.ServiceCatalogManager=class{constructor(e){this.locale=window.HelpCenter.user.locale.split("-")[0],this.timeStamp=e.timeStamp,this.ezoFieldId=e.ezoFieldId,this.ezoSubdomain=e.ezoSubdomain,this.ezoServiceItemFieldId=e.ezoServiceItemFieldId;r(this.filesToLoad(),(()=>{this.initialize()}))}initialize(){this.serviceCatalogBuilder=new w(this.locale,this.ezoSubdomain),this.addServiceCatalogMenuItem(),this.initServiceCatalog()}addServiceCatalogMenuItem(){this.serviceCatalogBuilder.addMenuItem("Service Catalog","/hc/p/service_catalog","user-nav")}initServiceCatalog(){i(/\/service_catalog$/i)?this.handleServiceCatalogRequest():i(/\/requests\/new$/)?new h(this.ezoFieldId,this.ezoSubdomain,this.ezoServiceItemFieldId).updateRequestForm():i(/\/requests\/(\d+)$/)&&new p(this.ezoFieldId,this.ezoSubdomain,this.ezoServiceItemFieldId).updateRequestForm()}handleServiceCatalogRequest(){o()?this.serviceCatalogBuilder.buildServiceCatalog():window.location.href=c()}filesToLoad(){return[{type:"link",url:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"},{type:"link",url:`https://mehboobali98.github.io/service-catalog/dist/public/stylesheets/service_catalog.css?${this.timeStamp}`},{type:"script",url:"https://code.jquery.com/jquery-3.6.0.min.js"}]}}}));

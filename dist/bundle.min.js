!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).ServiceCatalog=e.ServiceCatalog||{},e.ServiceCatalog.min=e.ServiceCatalog.min||{},e.ServiceCatalog.min.js={}))}(this,(function(exports){"use strict";const TRANSLATIONS={},PRODUCTION_CDN_URL="https://cdn.ezassets.com",DEFAULT_FIELD_VALUE="--",DEFAULT_TRUNCATE_LENGTH=30,CARD_FIELD_VALUE_TRUNCATE_LENGTH=15,SERVICE_ITEM_PLACEHOLDER_IMAGE_MAPPING={service_item:"service_item_placeholder",assigned_asset:"asset_placeholder",assigned_software_license:"software_license_placeholder"};function setLocale(e,t){if(0!==Object.keys(TRANSLATIONS).length&&t)return translatePage();fetchTranslationsFor(e).done((function(e){if($.extend(TRANSLATIONS,e),t)return translatePage()})).fail((function(){console.error("Failed to load translations.")}))}function fetchTranslationsFor(e){return $.getJSON(`https://mehboobali98.github.io/service-catalog/dist/public/${e}.json`)}function translatePage(){$("[data-i18n]").each((function(){translateElement($(this))}))}function translateElement(e){const t=e.attr("data-i18n"),s=TRANSLATIONS[t];if(void 0!==s)if(void 0!==e.attr("placeholder"))e.attr("placeholder",s);else if("report-issue"==t||"request"==t){var a=e.text(),i={request:"Request","report-issue":"Report Issue"};void 0!==i[t]&&(a=a.replace(i[t],s),e.text(a))}else e.text(s);else console.warn(`Translation for key '${t}' not found.`)}function generateI18nKey(e){return"Asset #"==e?"asset-sequence-num":"AIN"==e?"identifier":"Software License #"==e?"software-license-sequence-num":"License Identification Number"==e?"software-license-identifier":e.replace(/\s+/g,"-").toLowerCase()}function t(e,t){const s=TRANSLATIONS[e];return void 0!==s?s:t||""}function isRequestPage(){return isCorrectPage(/\/requests\/(\d+)$/)}function isNewRequestPage(){return isCorrectPage(/\/requests\/new$/)}function isServiceCatalogPage(){return isCorrectPage(/\/service_catalog$/i)}function isCorrectPage(e){return e.test(currentPage())}function currentPage(){return window.location.pathname}function loadExternalFiles(e,t){let s=0;function a(){s++,s===e.filter((e=>"script"===e.type)).length&&t()}e.forEach((e=>{loadFile(e.url,e.type,a)}))}function loadFile(e,t,s){const a=document.createElement(t);"link"===t?(a.rel="stylesheet",a.type="text/css",a.href=e):"script"===t&&(a.type="text/javascript",a.src=e,a.onload=s),document.head.appendChild(a)}function serviceCatalogDataPresent(e){return e&&e.service_catalog_data&&Object.keys(e.service_catalog_data).length>0}function isMyAssignedAssets(e){return/^\d*_my_assigned_assets$/.test(e)}function isSignedIn(){return!notSignedIn()}function notSignedIn(){return"anonymous"===window.HelpCenter.user.role}function returnToPath(){return window.location.href}function signInPath(){const e={};e.return_to=returnToPath();return`${origin()}/hc/signin?${$.param(e)}`}function origin(){return window.location.origin}function placeholderImagePath(e){let t=e.type,s=null;return s=t?SERVICE_ITEM_PLACEHOLDER_IMAGE_MAPPING[t]:SERVICE_ITEM_PLACEHOLDER_IMAGE_MAPPING.service_item,`https://mehboobali98.github.io/service-catalog/dist/public/${s}.svg`}function loadingIcon(e){const t=$("<div>").attr("id","loading_icon_container").addClass(e),s=$("<div>").addClass("d-flex flex-column align-items-center"),a=$("<img>").attr({src:"https://s2.svgbox.net/loaders.svg?ic=puff",alt:"Loading..."});return s.append(a),t.append(s),t}function getMyAssignedAssetsServiceItems(e){let t=e.service_items.assets||[],s=e.service_items.software_entitlements||[];return t.concat(s)}function getLocale(){return window.HelpCenter.user.locale.split("-")[0]}class SvgBuilder{constructor(){this.containerClass="kb-svg-icon"}build(e,t,s){this.getSvgCode(e)}getSvgCode(svgType){eval(`${svgType}Svg`)}angerSvg(){}happySvg(){}lovingSvg(){}satisfiedSvg(){}disappointedSvg(){}}class CustomerEffortSurvery{constructor(e){this.localte=e,this.svgBuilder=new SvgBuilder,this.emojisMapping={anger:1,disappointed:2,satisfied:3,happy:4,loving:5}}render(){const e=this.build();$("body").append(e),$("body").on("click",".js-customer-effort-survery-emoji-reaction",(function(e){e.preventDefault(),-1===$(this).attr("src").indexOf("filled")&&$(".js-customer-effort-survery-emoji-reaction").each((()=>{$(this).attr("src"),$(this).attr("src","new_image_url.jpg")}))})),$("#customer_effort_survey_modal").modal("show")}build(){const e=$("<div>").addClass("modal").attr("id","customer_effort_survey_modal").attr("role","dialog"),t=$("<div>").addClass("modal-dialog customer-effort-survery-dialog-position"),s=$("<div>").addClass("modal-content"),a=$("<div>").addClass("modal-header").append($("<h5>").addClass("modal-title").text("Feedback"),$("<button>").addClass("btn-close").attr("type","button").attr("data-bs-dismiss","modal").attr("aria-label","Close")),i=$("<div>").addClass("modal-body"),r=$("<div>").addClass("d-flex justify-content-between");Object.keys(this.emojisMapping).forEach((e=>{let t=e;this.svgBuilder.build(t);let s=$("<img>").addClass("js-customer-effort-survery-emoji-reaction").attr("src",`https://mehboobali98.github.io/service-catalog/dist/public/${t}.svg`).attr("id",t);r.append(s)}));const n=$("<label>").addClass("col-form-label").attr("for","comment").text("Comments:"),o=$("<textarea>").addClass("form-control").attr("id","comment").attr("rows","4"),c=$("<div>").addClass("modal-footer"),d=$("<button>").addClass("btn btn-primary").attr("id","submit").text("Send Feedback");return d.click(this.submitFeedback),c.append(d),i.append(r,n,o),s.append(a,i,c),t.append(s),e.append(t),e}submitFeedback(){const e=$("#comment").val(),t=$(".emojis-container .emoji").toArray().map((function(e){return $(e).attr("src")}));$.ajax({url:"your_api_endpoint",method:"POST",data:{comment:e,emojis:t},success:function(e){console.log("AJAX request successful",e)},error:function(e,t,s){console.error("AJAX request error:",s)}})}}class RequestForm{constructor(e,t,s,a){this.locale=e,this.ezoFieldId=t,this.ezoSubdomain=s,this.ezoServiceItemFieldId=a}updateRequestForm(){loadExternalFiles(this.filesToLoad(),(()=>{this.updateForm()}))}updateForm(){const e=this,t=this.extractRequestId(),s="/api/v2/requests/"+t;this.hideAssetsCustomField(),$.getJSON(s).done((s=>{const a=s.request.custom_fields.find((function(t){return t.id==e.ezoFieldId})),i=s.request.custom_fields.find((function(t){return t.id==e.ezoServiceItemFieldId})),r=e.fieldDataPresent(a),n=e.fieldDataPresent(i);if(!r&&!n)return!0;const o={headers:{}};return e.withToken((s=>{if(s){o.headers.Authorization="Bearer "+s,o.headers["ngrok-skip-browser-warning"]=!0,n&&!r&&e.linkResources(t,{headers:o.headers,serviceItemFieldId:e.ezoServiceItemFieldId});const c=JSON.parse(a.value),d=c.assets.map((e=>Object.keys(e)[0])),l=c.assets.map((e=>Object.values(e)[0]));if(!d||0==d.length||!i)return!0;"true"!=c.linked&&e.linkResources(t,{headers:o.headers,ezoFieldId:e.ezoFieldId}),l&&(e.addEZOContainer(),l.map((t=>{e.showLinkedAsset(t)})))}}))}))}extractRequestId(){return window.location.pathname.split("/").pop()}hideAssetsCustomField(){const e=$("dd:contains('{\"assets\":[{')");e[0]&&(e[0].style.display="none",e[0].previousElementSibling.style.display="none")}withToken(e){return $.getJSON("/hc/api/v2/integration/token").then((t=>e(t.token)))}linkResources(e,t){const s=t.ezoFieldId,a=t.serviceItemFieldId,i={ticket_id:e};s&&(i.assets_field_id=s),a&&(i.service_item_field_id=a);const r=t.headers||{};$.ajax({url:"https://"+this.ezoSubdomain+"/webhooks/zendesk/link_ticket_to_resource.json",type:"POST",data:{ticket:i},headers:r,success:function(e){new CustomerEffortSurvery(this.locale).render(),console.log("AJAX request successful",e)},error:function(e,t,s){console.error("AJAX request error:",s)}})}addEZOContainer(){$("dl.request-details").last().after('<dl class="request-details" id="ezo-assets-container"><dt>AssetSonar Assets</dt><dd><ul></ul></dd></dl>')}showLinkedAsset(e){const t=this.getAssetUrl(e),s=$("#ezo-assets-container dd ul");t?s.append("<li><a target='_blank' href='"+t+"'>"+e+"</a></li>"):s.append("<li>"+e+"</li>")}getAssetUrl(e){if(!e)return null;const t=(e=e.trim()).match(/^(Asset|Asset Stock|Software License) # (\d+) /);if(!t)return null;const s=t[2],a=t[1];return"https://"+this.ezoSubdomain+this.getAssetPath(s,a)}getAssetPath(e,t){return({Asset:"/assets/","Stock Asset":"/stock_assets/","Software License":"/software_licenses/"}[t]||"/dashboard")+e}fieldDataPresent(e){return e&&e.value}filesToLoad(){return[{type:"link",url:"https://mehboobali98.github.io/service-catalog/dist/public/customer_effort_survey.css"},{type:"script",url:"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"}]}}class NewRequestForm{constructor(e,t,s){this.ezoFieldId=e,this.ezoSubdomain=t,this.ezoServiceItemFieldId=s}updateRequestForm(){loadExternalFiles(this.filesToLoad(),(()=>{this.updateForm()}))}updateForm(){if("-"===$(".nesty-input")[0].text)return;const e=this.extractQueryParams(window.location),t=this.prepareSubject(e),s=this.prepareServiceItemFieldValue(e);t&&$("#request_subject").val(t),s&&$("#request_custom_fields_"+this.ezoServiceItemFieldId).val(s),this.getTokenAndFetchAssignedAssets()}extractQueryParams(e){return new URL(e).searchParams}getTokenAndFetchAssignedAssets(){return this.withToken().then((e=>{if(e){const t={method:"GET",headers:{Authorization:"Bearer "+e,"ngrok-skip-browser-warning":!0}},s="https://"+this.ezoSubdomain+"/webhooks/zendesk/user_assigned_assets_and_software_entitlements.json";return this.populateAssignedAssets(s,t)}}))}withToken(){return $.getJSON("/hc/api/v2/integration/token").then((e=>e.token))}populateAssignedAssets(e,t){fetch(e,t).then((e=>e.json())).then((s=>{const a={data:[]},i=$("#request_custom_fields_"+this.ezoFieldId);this.processData(s.assets,a,"Asset"),this.processData(s.software_entitlements,a,"Software License"),i.hide(),i.after("<select multiple='multiple' id='ezo-asset-select' style='width: 100%;'></select>"),this.renderSelect2PaginationForUsers($("#ezo-asset-select"),e,t),this.preselectAssetsCustomField(this.extractQueryParams(window.location)),$("form.request-form").on("submit",(function(){var e=$("#ezo-asset-select").val();if(e.length>0){let t=a.data.filter((t=>e.includes(t.id.toString())));t=t.map((e=>({[e.id]:e.text}))),i.val(JSON.stringify({assets:t}))}}))}))}renderSelect2PaginationForUsers(e,t,s){e.select2({dropdownParent:e.parents("body"),ajax:{url:t,delay:250,headers:s.headers,dataType:"json",data:function(t){return{page:t.page||1,search:t.term,include_blank:$(e).data("include-blank")}},processResults:function(e,t){var s=$.map(e.assets,(function(e){var t=e.sequence_num;return{id:t,text:`Asset # ${t} - ${e.name}`}})),a=$.map(e.software_entitlements,(function(e){var t=e.sequence_num;return{id:t,text:`Software License # ${t} - ${e.name}`}}));return{results:s.concat(a),pagination:{more:e.page<e.total_pages}}}}})}prepareSubject(e){const s=e.get("item_name"),a=e.get("service_category");return null==s||null==a?null:`${t("report-issue","Report Issue")} on ${a} - ${s}`}prepareServiceItemFieldValue(e){const t=e.get("item_name"),s=e.get("service_item_id");return null==t&&null==s?null:s?`${s} - ${t}`:t}preselectAssetsCustomField(e){let t=$("#request_custom_fields_"+this.ezoFieldId);if(!this.assetsCustomFieldPresent(t))return;let s=e.get("item_id"),a=e.get("item_name");if(!a||!s)return;let i=$("#ezo-asset-select");if(0===i.length&&this.renderEzoSelect2Field(t),i.find("option[value='"+s+"']").length)i.val(s).trigger("change");else{var r=new Option(a,s,!0,!0);i.append(r).trigger("change")}}assetsCustomFieldPresent(e){return e.length>0}renderEzoSelect2Field(e){e.hide(),e.after("<select multiple='multiple' id='ezo-asset-select' style='width: 100%;'></select>")}filesToLoad(){return[{type:"link",url:"https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css"},{type:"script",url:"https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"}]}processData(e,t,s){e&&$.each(e,(function(e,a){var i=a.sequence_num;t.data[i]={id:i,text:`${s} # ${i} - ${a.name}`}}))}}function serviceCatalogDisabled(e){const t=$("<div>").addClass("d-flex flex-column align-items-center service-catalog-disabled-container"),s=$("<img>").attr("src",`${PRODUCTION_CDN_URL}/shared/service_catalog/dist/public/images/svg/no_access_image.svg`).addClass("no-access-image"),a=$("<p>").attr("data-i18n","enable-service-catalog").text("Please enable Service Catalog Builder in Asset Sonar to start using Service Catalog.").addClass("next-steps-message"),i=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),r=`https://${e}/companies/settings`,n=$("<a>").attr("href",r).attr("data-i18n","go-to-assetsonar").text("Go to AssetSonar").addClass("btn btn-outline-primary go-back-btn");return i.append(n),t.append(s,a,i),t}function serviceCatalogEmpty(e){const t=$("<div>").addClass("d-flex flex-column align-items-center service-catalog-empty-container"),s=$("<img>").attr("src",`${PRODUCTION_CDN_URL}/shared/service_catalog/dist/public/images/svg/service_category.svg`).addClass("no-access-image"),a=$("<p>").attr("data-i18n","create-and-enable-service-categories").text("Please create and enable service categories in the builder to start using Service Catalog.").addClass("next-steps-message"),i=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),r=`https://${e}/service_catalog/builder`,n=$("<a>").attr("href",r).attr("data-i18n","go-to-service-catalog-builder").text("Go to Service Catalog Builder").addClass("btn btn-outline-primary go-back-btn");return i.append(n),t.append(s,a,i),t}function noResultsFound(){const e=$("<div>").attr("id","no_results_container").addClass("d-flex flex-column align-items-center no-results-container"),t=$("<img>").attr("src",`${PRODUCTION_CDN_URL}/shared/service_catalog/dist/public/images/svg/no_results_found.svg`).addClass("no-results-image"),s=$("<p>").attr("data-i18n","no-results-found").text("No Result Found").addClass("no-results-message");return e.append(t,s),e}function noServiceItems(e){const t=$("<div>").attr("id","no_service_items_found_container").addClass("d-flex flex-column align-items-center no-results-container"),s=$("<img>").attr("src",`${PRODUCTION_CDN_URL}/shared/service_catalog/dist/public/images/svg/service_asset.svg`).addClass("no-results-image"),a=$("<p>").attr("data-i18n",e).text(notFoundMessage).addClass("no-results-message");return t.append(s,a),t}class ServiceCatalogItemDetailBuilder{constructor(e){this.locale=e,this.currency=null,this.serviceCategoriesItems=null}build(e){this.currency=e.currency,this.serviceCategoriesItems=e.service_catalog_data,$.each(this.serviceCategoriesItems,((e,t)=>{let s=$(`#${`${e}_container`}`);if(!isMyAssignedAssets(e)&&t.service_items){let a=JSON.parse(t.service_items);$.each(a,((t,a)=>{s.after(this.buildDetailPage(e,a)),this.bindItemDetailEventListener(e,a)}))}}))}buildDetailPage(e,t){const s=t.display_fields,a=`detail_page_container${t.id}${e}${s.title.value}`,i={},r=$("<div>").attr("id",a).addClass("row").css({display:"none","margin-top":"38px","margin-right":"184px"}),n=$("<div>").addClass("col-3"),o=placeholderImagePath(t),c=$("<img>").attr("src",t.display_picture_url||o).attr("alt","placeholder image").addClass("w-100").on("error",(function(){$(this).attr("src",o)}));n.append(c),getComputedStyle(document.documentElement).getPropertyValue("--ez_text_font");const d=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_color"),l=getComputedStyle(document.documentElement).getPropertyValue("--ez_heading_font"),u=$("<div>").addClass("col-9"),p=$("<div>").addClass("d-flex justify-content-between"),h=$("<div>").append($("<p>").text(s.title.value).css({color:d,"line-height":"17px","font-family":l,"font-weight":"600","font-size":"16px"}));s.cost_price&&h.append($("<p>").text(`${this.currency} ${parseFloat(s.cost_price.value)}`).css({color:d,"line-height":"17px","font-family":l,"font-size":"14px"})),i.item_name=s.title.value,i.ticket_form_id=t.zendesk_form_id,i.service_item_id=t.id,i.service_category=this.serviceCategoriesItems[e].title;const m=`/hc/requests/new?${$.param(i)}`,g=$("<div>").addClass("request-service-btn-container"),v=$("<a>").attr("href",m).attr("data-i18n","request-service").text("Request Service").addClass("btn btn-outline-primary request-service-btn");g.append(v),p.append(h,g);const f=$("<div>").addClass("mt-3");return Object.keys(s).length&&$.each(s,((e,t)=>{if("description"==e){let e=$("<section>"),s=$("<p>").attr("data-i18n","service-item-details").text(t.label).css({color:d,"line-height":"17px","font-style":l,"font-weight":"600","font-size":"16px"}),a=this.prepareSectionContent(t);e.append(s,a),f.append(e)}})),u.append(p,f),r.append(n,u),r}prepareSectionContent(e){const t=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_font"),s=getComputedStyle(document.documentElement).getPropertyValue("--ez_text_color"),a=e.value,i=e.format;if(!i)return $("<p>").text(a).css({color:s,"font-size":"14px","font-weight":"400","line-height":"17px","font-family":t,"font-size":"12px"});if("list"===i){const e=$("<ul>").addClass("service-item-detail-description-list"),t=a.split(",");return $.each(t,(function(t,s){let a=$("<li>").text(s);e.append(a)})),e}}bindItemDetailEventListener(e,t){$("body").on("click",".js-service-item-detail-page-btn, .js-default-service-item",(function(e){e.preventDefault();const t=$(this).data("id"),s=$(this).data("name"),a=$(this).data("container-id"),i=$(`#${a}`),r=`detail_page_container${t}${s}`,n=$(document.getElementById(r));$("#service_catalog_item_search_results_container").hide(),i.hide(),$("[id*='_service_items_container']").hide(),$("#service_items_container").show(),n.show()}))}}class ServiceCatalogItemBuilder{constructor(e){this.locale=e,this.currency=null,this.zendeskFormData=null,this.serviceCategoriesItems=null}build(e){this.currency=e.currency,this.serviceCategoriesItems=e.service_catalog_data;const t=Object.keys(this.serviceCategoriesItems),s=$("<div>").attr("id","service_items_container").addClass("col-10 service-items-container");return t.forEach(((e,t)=>{const a=this.serviceCategoriesItems[e];s.append(this.buildServiceCategoryItems(e,a,0===t))})),s}buildServiceCategoryItems(e,t,s){const a=$("<div>");a.attr("id",`${e}_container`),s||a.addClass("collapse");const i=t.title,r=$("<p>").attr("data-i18n",generateI18nKey(i)).text(i).addClass("service-category-label"),n=$("<p>").attr("data-i18n",generateI18nKey(`${i} Description`)).text(t.description).addClass("service-category-description");a.append(r,n);const o=$("<div>").attr("id",`${e}_service_items_container`);s||o.append(loadingIcon("col-10"));const c=$("<div>").addClass("d-flex flex-wrap gap-3");if(t.service_items){let s=[];isMyAssignedAssets(e)?(s=getMyAssignedAssetsServiceItems(t),this.zendeskFormData=t.zendesk_form_data):s=t.service_items?JSON.parse(t.service_items):[],s.length&&s.forEach(((t,s)=>{t&&c.append(this.buildServiceCategoryItem(e,t))}))}else isMyAssignedAssets(e)&&o.append(noServiceItems("There are no assigned items for you in the system."));return o.append(c),a.append(o),a}buildServiceCategoryItem(e,t){return isMyAssignedAssets(e)?this.buildItAssetServiceItem(e,t):this.buildDefaultServiceItem(e,t)}buildItAssetServiceItem=(e,s)=>{const a=$("<div>").addClass("row service-item-card"),i={},r=this.serviceCategoriesItems[e].title,n=$("<div>").addClass("col-4"),o=$("<div>").addClass("d-flex flex-column h-100 service-item-card-image-container"),c=placeholderImagePath(s),d=$("<img>").attr("src",s.display_picture_url).attr("alt","IT Asset").addClass("w-100").on("error",(function(){$(this).attr("src",c)}));o.append(d),n.append(o);const l=$("<div>").addClass("col-8 card-body"),u=s.name,p=$("<p>").text(u).addClass("card-title truncate-text").attr("data-text",u);l.append(p);const h=$("<div>").addClass("card-content-container"),m=$("<table>").addClass("card-content-table");this.populateCardContent(m,s),h.append(m),l.append(h),i.item_id=s.sequence_num,i.item_name=u,i.ticket_form_id=this.zendeskFormId(s),i.service_category=t(generateI18nKey(r),r);const g=`/hc/requests/new?${$.param(i)}`,v=$("<div>").addClass("it-asset-card-footer w-100"),f=$("<a>").attr("href",g).attr("data-i18n","report-issue").text("Report Issue").addClass("float-end footer-text");return f.append($("<span>").html("&#8594;").addClass("footer-arrow")),v.append(f),l.append(v),a.append(n,l),a.click((function(e){e.preventDefault(),window.location.href=g})),a};buildDefaultServiceItem(e,t){const s=t.display_fields,a=$("<div>").addClass("row service-item-card border border-light js-default-service-item").data("id",`${t.id}${e}`).data("name",s.title.value).data("container-id",`${e}_service_items_container`),i=$("<div>").addClass("col-4"),r=$("<div>").addClass("d-flex flex-column h-100 service-item-card-image-container"),n=placeholderImagePath(t),o=$("<img>").attr("src",t.display_picture_url||n).attr("alt","Software").addClass("w-100").on("error",(function(){$(this).attr("src",n)}));r.append(o),i.append(r);const c=$("<div>").addClass("col-8 card-body"),d=s.title.value,l=$("<p>").text(d).addClass("card-title truncate-text").attr("data-text",d);c.append(l);const u=$("<p>").text(s.short_description.value).addClass("description");c.append(u);const p=$("<div>").addClass("card-footer w-100");if(s.cost_price){const e=$("<span>").text(`${this.currency} ${parseFloat(s.cost_price.value)}`);p.append(e)}const h=$("<a>").attr("href","#_").attr("data-i18n","request").text("Request").addClass("float-end footer-text"),m=$("<span>").html("&#8594;").addClass("footer-arrow float-end js-service-item-detail-page-btn").data("id",`${t.id}${e}`).data("name",s.title.value).data("container-id",`${e}_service_items_container`);return h.append(m),p.append(h),c.append(p),a.append(i,c),a}populateCardContent(e,t){const s=t.asset_columns||t.software_license_columns;if(0!==Object.keys(s).length)$.each(s,((t,s)=>{let a=$("<tr>"),i=this.fieldValueElement(t||DEFAULT_FIELD_VALUE,"th",DEFAULT_TRUNCATE_LENGTH);"fr"==this.locale&&i.attr("data-i18n",generateI18nKey(t)),a.append(i),a.append(this.fieldValueElement(s||DEFAULT_FIELD_VALUE,"td",CARD_FIELD_VALUE_TRUNCATE_LENGTH)),e.append(a)}));else{const t="No attributes configured";e.append($("<tr>").append(this.fieldValueElement(t,"th",t.length).attr("data-i18n","no-attributes-configured")))}}fieldValueElement(e,t,s){const a=$(`<${t}>`),i=e.length>s;if(!i)return a.text(e);const r=i?`${e.substring(0,s)}...`:e;return a.text(r).attr("title",e).attr("data-toggle","tooltip")}zendeskFormId(e){const t=e.type;return"assigned_asset"===t?this.zendeskFormData.assets:"assigned_software_license"===t?this.zendeskFormData.software_entitlements:void 0}buildAndRenderServiceItems=(e,t)=>{const s=e.service_catalog_data;this.currency=e.currency;const a=Object.keys(s)[0],i=s[a];$(t).children().first().hide();const r=$(t).children().last();r.empty();let n=[];n=isMyAssignedAssets(a)?getMyAssignedAssetsServiceItems(i):i.service_items?JSON.parse(i.service_items):[],n.length&&n.forEach(((e,t)=>{e&&r.append(this.buildServiceCategoryItem(a,e))})),isMyAssignedAssets(a)||(new ServiceCatalogItemDetailBuilder).build(e)}}class Search{constructor(){this.itemBuilder=null,this.itemDetailBuilder=null}updateResults=(e,t)=>{const s=t.searchResultsContainer;if(s.empty(),!e.search_results.length)return void s.append(noResultsFound());self=this,self.itemBuilder=t.itemBuilder;const a=$("<div>").addClass("d-flex flex-wrap gap-3");self.itemDetailBuilder=t.itemDetailBuilder;const i=Array.isArray(e.search_results)?e.search_results:JSON.parse(e.search_results);$.each(i,(function(e,t){if(t){let e=t.service_category_title_with_id,s=self.itemBuilder.buildServiceCategoryItem(e,t);self.itemDetailBuilder.bindItemDetailEventListener(s),a.append(s)}})),s.append(a)}}class ApiService{constructor(e,t){this.locale=e,this.ezoSubdomain=t}fetchServiceCategoriesAndItems(e,t,s){$.getJSON("/hc/api/v2/integration/token").then((e=>e.token)).then((a=>{if(a){const i="visible_service_categories_and_items",r={},n={method:"GET",headers:{Authorization:"Bearer "+a,"ngrok-skip-browser-warning":!0}};s.searchQuery&&(r.search_query=s.searchQuery);const o="https://"+this.ezoSubdomain+"/webhooks/zendesk/"+i+".json?"+$.param(r);fetch(o,n).then((e=>{if(400==e.status)throw new Error("Bad Request: There was an issue with the request.");if(403==e.status)return e.json().catch((()=>t()));if(404==e.status)return t();if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((t=>{$("#loading_icon_container").empty(),void 0===t.service_catalog_enabled||t.service_catalog_enabled?serviceCatalogDataPresent(t)||t.search_results?e(t,s):$("main").append(serviceCatalogEmpty(this.ezoSubdomain)):$("main").append(serviceCatalogDisabled(this.ezoSubdomain)),setLocale(this.locale,!0)})).catch((e=>{console.error("An error occurred while fetching service categories and items: "+e.message)}))}}))}fetchServiceCategoryItems(e,t,s){$.getJSON("/hc/api/v2/integration/token").then((e=>e.token)).then((a=>{if(a){const i={method:"GET",headers:{Authorization:"Bearer "+a,"ngrok-skip-browser-warning":!0}},r="visible_service_categories_and_items",n={service_category_id:e},o="https://"+this.ezoSubdomain+"/webhooks/zendesk/"+r+".json?"+$.param(n);$("#loading_icon_container").show(),fetch(o,i).then((e=>{if(400===e.status)throw new Error("Bad Request: There was an issue with the request.");if(404===e.status)return noAccessPageCallback();if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e,s.serviceItemsContainerId),setLocale(this.locale,!0)})).catch((e=>{console.error("An error occurred while fetching service categories and items: "+e.message)}))}}))}withToken(){return $.getJSON("/hc/api/v2/integration/token").then((e=>e.token))}}class ServiceCatalogBuilder{constructor(e,t){this.locale=e,this.apiService=new ApiService(e,t),this.ezoSubdomain=t,this.serviceCatalogItemBuilder=new ServiceCatalogItemBuilder(e),this.serviceCatalogItemDetailBuilder=new ServiceCatalogItemDetailBuilder(e),this.search=new Search}addMenuItem(e,t,s){const a=$(`#${s}`),i=$("<a>",{href:t,text:e}).addClass("service-catalog-nav-item nav-link").attr("data-i18n","service-catalog"),r=a.children(":first");r.is("ul")?r.prepend($("<li>").append(i)):a.prepend(i)}buildServiceCatalog(){this.buildServiceCatalogHeaderSection(),$("main").append(loadingIcon("mt-5")),this.apiService.fetchServiceCategoriesAndItems(this.buildUI,this.noAccessPage,{})}buildServiceCatalogHeaderSection(){const e=$("<section>"),t=$("<div>").addClass("jumbotron jumbotron-fluid service-catalog-header-container"),s=$("<h2>").addClass("service-catalog-header-label").attr("data-i18n","service-catalog").text("Service Catalog"),a=$("<p>").addClass("service-catalog-description").attr("data-i18n","service-catalog-description").text("Explore the Service Catalog to find a curated range of solutions to your needs");t.append(s,a),e.append(t),$("main").append(e)}buildUI=(e,t)=>{this.data=e;const s=$("<section>").attr("id","service_catalog_section").addClass("service-catalog-section"),a=$("<div>").addClass("row"),i=$("<div>").addClass("col-2"),r=$("<p>").addClass("service-categories-heading").attr("data-i18n","categories").text("Categories"),n=$("<input>").attr("id","search_input").attr("type","text").attr("data-i18n","search").attr("placeholder","search..."),o=$("<div>").append(n).addClass("service-catalog-search");i.append(r,o);const c={newSection:s,searchAndNavContainer:i,serviceCatalogContainer:a};this.createServiceCategoriesView(c)};createServiceCategoriesView(e){const t=$("<div>").attr("id","service_categories_list").addClass("service-categories-list"),s=this.generateNavbar();t.append(s);const a=e.newSection,i=e.searchAndNavContainer,r=e.serviceCatalogContainer;i.append(t);const n=this.serviceCatalogItemBuilder.build(this.data),o=$("<div>").attr("id","service_catalog_item_search_results_container").addClass("col-10 collapse service-catalog-search-results-container");r.append(i,n,o),a.append(r),$("main").append(a),this.serviceCatalogItemDetailBuilder.build(this.data),this.bindEventListeners(),this.addTooltipsForTruncatedText()}generateNavbar(){const e=$("<ul>");let t=!1;const s=this.data.service_catalog_data;return $.each(s,(function(s,a){let i=$("<li>").append($("<a>").attr({id:s+"_link",href:"#_",target:"_blank","data-i18n":generateI18nKey(a.title)}).text(a.title));t||(t=!0,i.addClass("active")),e.append(i)})),e}bindEventListeners(){let e=null;const t=this,s=Object.keys(this.data.service_catalog_data).map((e=>"#"+e+"_link"));$(s.join(", ")).click((function(e){var a=$(this).attr("id");if($("#"+e.target.id).parent().hasClass("active"))return!1;$("#service_categories_list ul li.active").removeClass("active"),$("#"+e.target.id).parent().addClass("active"),e.preventDefault();var i=a.replace("_link","_container");$.each(s,(function(e,t){"#"+a===t||$(t.replace("_link","_container")).hide()})),$("[id*='detail_page_container']").hide();const r={serviceItemsContainerId:"#"+i.replace("_container","_service_items_container")},n=a.split("_")[0];t.apiService.fetchServiceCategoryItems(n,t.serviceCatalogItemBuilder.buildAndRenderServiceItems,r),$("#service_catalog_item_search_results_container").hide(),$("#"+i).show(),$("#"+i.replace("_container","_service_items_container")).show(),$("#service_items_container").show()})),$("#search_input").on("keyup",(function(s){s.preventDefault();const a=$(this).val().trim(),i=$("#service_items_container"),r=$("#service_catalog_item_search_results_container");$("#service_categories_list ul li.active"),0===a.length?(r.hide(),i.show()):(i.hide(),r.empty(),r.append(loadingIcon("col-10")),r.show(),e&&clearTimeout(e),e=setTimeout((function(){t.apiService.fetchServiceCategoriesAndItems(t.search.updateResults,t.noAccessPage,{searchQuery:a,searchResultsContainer:r,itemBuilder:t.serviceCatalogItemBuilder,itemDetailBuilder:t.serviceCatalogItemDetailBuilder})}),500))}))}addTooltipsForTruncatedText(){$(".truncate-text, .truncate-text-two-lines").each((function(){if(this.scrollWidth>this.offsetWidth){var e=$(this).attr("data-text");$(this).attr("title",e).attr("data-toggle","tooltip")}}))}noAccessPage(){const e=$("<section>").attr("id","no_access_page_section").addClass("no-access-page-section"),t=$("<div>").addClass("d-flex flex-column align-items-center"),s=$("<img>").attr("src","https://mehboobali98.github.io/service-catalog/dist/public/no_access_image.svg").addClass("no-access-image"),a=$("<h4>").attr("data-i18n","unauthorized-label").text("You do not have permission to access this page!"),i=$("<p>").attr("data-i18n","contact-administrator-label").text("Please contact your administrator to get access").addClass("next-steps-message"),r=$("<div>").addClass("d-flex mt-3 gap-3 justify-content-end"),n=$("<a>").attr("href","#_").attr("data-i18n","go-back").text("Go Back").addClass("btn btn-outline-primary go-back-btn").click((function(){window.history.back()}));r.append(n),t.append(s,a,i,r),e.append(t),$("main").append(e)}}class ServiceCatalogManager{constructor(e){this.locale=getLocale(),this.timeStamp=e.timeStamp,this.ezoFieldId=e.ezoFieldId,this.ezoSubdomain=e.ezoSubdomain,this.ezoServiceItemFieldId=e.ezoServiceItemFieldId;loadExternalFiles(this.filesToLoad(),(()=>{this.initialize()}))}initialize(){this.serviceCatalogBuilder=new ServiceCatalogBuilder(this.locale,this.ezoSubdomain),this.addServiceCatalogMenuItem(),this.initServiceCatalog()}addServiceCatalogMenuItem(){this.serviceCatalogBuilder.addMenuItem("Service Catalog","/hc/p/service_catalog","user-nav")}initServiceCatalog(){setLocale(this.locale,!1),isServiceCatalogPage()?this.handleServiceCatalogRequest():isNewRequestPage()?new NewRequestForm(this.ezoFieldId,this.ezoSubdomain,this.ezoServiceItemFieldId).updateRequestForm():isRequestPage()&&new RequestForm(this.locale,this.ezoFieldId,this.ezoSubdomain,this.ezoServiceItemFieldId).updateRequestForm()}handleServiceCatalogRequest(){isSignedIn()?this.serviceCatalogBuilder.buildServiceCatalog():window.location.href=signInPath()}filesToLoad(){return[{type:"link",url:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"},{type:"link",url:`https://mehboobali98.github.io/service-catalog/dist/public/service_catalog.css?${this.timeStamp}`},{type:"script",url:"https://code.jquery.com/jquery-3.6.0.min.js"}]}}exports.ServiceCatalogManager=ServiceCatalogManager}));
